

1. Сделать скриптик, который при запуске делает всё что мне нужно
	- ввод: (N строчек, R rps, конфиги бдшки)
	- Запускает пг / мускуль / оракл
	- наливает туда строчки
	- запускает нагрузку
	- возвращает мне 0.5 0.9 0.99 перцентили

2. Сделать все конфиги которые я хочу
3. Позапускать локально, потом позапускать в облаке, чтобы удалить шум от моего мака


Проблемы
1. РТ каждого запроса зависит от параллельности ака количества коннектов
	Решение: тестировать на одном запросе / низкой нагрузке. Смотреть не на рт а на ??? или на рт?
Давайте посмотрим какие резы мы получим

TPS - transaction per second, в нашем случае select-ов в секунду

create table test_1 (id int8, data int8);
hash(id);
select id, data from test_1 where id=$1 // 10k tps
---
1e4 - mean 45 us; 0.9 62 us; 0.99 94 us
1e5 - mean 45 us; 0.9 61 us; 0.99 151 us
1e6 - mean 47 us; 0.9 63 us; 0.99 94 us
1e7 - mean 54 us; 0.9 258 us; 0.99 28382 us -- уперлись на самом деле в параллельность
2e7 - mean 265 us; 0.9 428 us; 0.99 118649 us
1e8 - слишком долго сука наполнять

O(1) + проблемы с коллизиями в моменте 1e7, интересно

btree(id)
---
1e6 - mean 47 us; 0.9 64 us; 0.99 228 us
1e7 - mean 56 us; 0.9 274 us; 0.99 25413 us
2e7 - mean 239 us; 0.9 328 us; 0.99 13281 us


===
Забыли про параллельность вообще. Что будет на одном коннекте? поставлю тпс 1000
---
1e6 30 tps - mean 666 us; 0.9 852 us; 0.99 1092 us
			 mean 660 us; 0.9 827 us; 0.99 990 us

1e6 15 tps - mean 634 us; 0.9 882 us; 0.99 1402 us

1e6 10 tps - mean 590 us; 0.9 680 us; 0.99 890 us
			 mean 786 us; 0.9 971 us; 0.99 1773 us

1e6 5 tps - mean 861 us; 0.9 993 us; 0.99 1607 us
			mean 898 us; 0.9 1114 us; 0.99 3836 us
 			mean 892 us; 0.9 1020 us; 0.99 1213 us
			mean 716 us; 0.9 946 us; 0.99 1105 us

1e6 1 tps - mean 954 us; 0.9 1421 us; 0.99 4123 us

почему сука чем реже мы выполняем запросы тем хуже они отрабатывают
окей, скажем что это погрешность. Погрешность!

hash
---
1e7 20tps 5m - mean 1196 us; 0.9 1782 us; 0.99 7258 us
2e7 20tps 5m - mean 724 us; 0.9 920 us; 0.99 1988 us

btree
---
1e7 20tps 5m - 
2e7 20tps 5m - 



сделал хеш индекс на 2е7, рпс 15 коннект 1, 5 минут == 4500 requests
-
1 - mean 1552 us; 0.9 2992 us; 0.99 30575 us
2 - mean 603 us; 0.9 837 us; 0.99 3220 us
3 - mean 592 us; 0.9 795 us; 0.99 2304 us
4 - mean 639 us; 0.9 821 us; 0.99 1895 us
5 - mean 631 us; 0.9 1326 us; 0.99 5486 us
6 - mean 619 us; 0.9 807 us; 0.99 1720 us
7 - mean 603 us; 0.9 840 us; 0.99 3070 us
8 - mean 508 us; 0.9 729 us; 0.99 2401 us
9 - mean 446 us; 0.9 784 us; 0.99 3632 us
10 - mean 435 us; 0.9 681 us; 0.99 2484 us
11 - mean 423 us; 0.9 629 us; 0.99 2650 us
12 - mean 532 us; 0.9 954 us; 0.99 6865 us
13 - mean 438 us; 0.9 725 us; 0.99 7653 us


Прогреваются кеши? Считаются статистики?


на уровне погрешности...

2. Дефолтные конфигурации постгреса / мускуля / оракла будут отличаться по параллельности. 
	- Использовать 1 коннект / одно ядро ? ебать как медленно будет, хотя наверное я могу себе позволить подождать
		звучит очень хорошо, потому что базово мы хотим побенчмаркать скорость алгоса индекса и системы хранения данных, а не возможности параллельной обработки. те по сути мы не хотим упираться ни в CPU ни в io, несмотря на то что их мы тоже хотим измерить.
	- 


